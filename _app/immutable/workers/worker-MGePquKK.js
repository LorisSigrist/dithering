var kt=Object.defineProperty;var It=(d,m,w)=>m in d?kt(d,m,{enumerable:!0,configurable:!0,writable:!0,value:w}):d[m]=w;var R=(d,m,w)=>(It(d,typeof m!="symbol"?m+"":m,w),w),J=(d,m,w)=>{if(!m.has(d))throw TypeError("Cannot "+w)};var p=(d,m,w)=>(J(d,m,"read from private field"),w?w.call(d):m.get(d)),E=(d,m,w)=>{if(m.has(d))throw TypeError("Cannot add the same private member more than once");m instanceof WeakSet?m.add(d):m.set(d,w)},A=(d,m,w,z)=>(J(d,m,"write to private field"),z?z.call(d,w):m.set(d,w),w);var N=(d,m,w)=>(J(d,m,"access private method"),w);(function(){"use strict";var y,C,O,k,B,I,S,W,Z,_,L;function d(e){if(e.length>4096)throw new Error("Too many colors - max 4096 colors");if(e.length<1)throw new Error("No colors provided");const t=new ImageData(64,64),r=new Uint8ClampedArray(e.length*4);for(let n=0;n<e.length;n++){const i=e[n];r.set(i,n<<2),r[n<<2|3]=255}const o=4095,s=15;for(let n=0;n<=o;n++){const i=n>>6,u=n&63,c=n&s,h=n>>4&s,a=n>>8&s;let f=0,l=Number.MAX_SAFE_INTEGER;for(let M=0;M<e.length;M++){const at=((c<<4)-r[M<<2])**2+((h<<4)-r[M<<2|1])**2+((a<<4)-r[M<<2|2])**2;at<l&&(f=M,l=at)}const g=(u<<6|i)<<2;t.data.set(r.slice(f<<2,(f<<2)+4),g)}return t}const m=8,w=5,z=1e3,j=w,b=m-w,ct=.75;function G(e,t){return e<t?-1:e>t?1:0}class X{constructor(t){E(this,k);E(this,y,[]);E(this,C,!1);E(this,O,void 0);A(this,O,t)}push(t){p(this,y).push(t),A(this,C,!1)}peek(t){return N(this,k,B).call(this),t===void 0&&(t=p(this,y).length-1),p(this,y)[t]}pop(){return N(this,k,B).call(this),p(this,y).pop()}size(){return p(this,y).length}map(t){return p(this,y).map(t)}[Symbol.iterator](){return N(this,k,B).call(this),p(this,y)[Symbol.iterator]()}}y=new WeakMap,C=new WeakMap,O=new WeakMap,k=new WeakSet,B=function(){p(this,C)||(p(this,y).sort(p(this,O)),A(this,C,!0))};const $=class ${constructor(t,r,o,s,n,i,u){E(this,W);E(this,I,void 0);E(this,S,void 0);R(this,"r1");R(this,"r2");R(this,"g1");R(this,"g2");R(this,"b1");R(this,"b2");R(this,"histogram");this.r1=t,this.r2=r,this.g1=o,this.g2=s,this.b1=n,this.b2=i,this.histogram=u}volume(){return(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)}count(t=!1){if(p(this,I)===void 0||t){let r=0;for(const[o,s,n]of N(this,W,Z).call(this))r+=this.histogram.sampleWithReducedColor(o,s,n);A(this,I,r)}return p(this,I)}copy(){return new $(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histogram)}avg(t=!1){if(!p(this,S)||t){let r=0;const o=1<<b;let s=0,n=0,i=0;for(const[u,c,h]of N(this,W,Z).call(this)){let a=this.histogram.sampleWithReducedColor(u,c,h);r+=a,s+=a*(u+.5)*o,n+=a*(c+.5)*o,i+=a*(h+.5)*o}r>0?A(this,S,[Math.floor(s/r),Math.floor(n/r),Math.floor(i/r)]):A(this,S,[Math.floor(o*(this.r1+this.r2+1)/2),Math.floor(o*(this.g1+this.g2+1)/2),Math.floor(o*(this.b1+this.b2+1)/2)])}return p(this,S)}contains(t){const r=t[0]>>b,o=t[1]>>b,s=t[2]>>b;return r>=this.r1&&r<=this.r2&&o>=this.g1&&o<=this.g2&&s>=this.b1&&s<=this.b2}};I=new WeakMap,S=new WeakMap,W=new WeakSet,Z=function*(){for(let t=this.r1;t<=this.r2;t++)for(let r=this.g1;r<=this.g2;r++)for(let o=this.b1;o<=this.b2;o++)yield[t,r,o]};let D=$;class lt{constructor(){E(this,_,void 0);A(this,_,new X((t,r)=>G(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())))}push(t){p(this,_).push({vbox:t,color:t.avg()})}palette(){return p(this,_).map(t=>t.color)}size(){return p(this,_).size()}map(t){for(const r of p(this,_))if(r.vbox.contains(t))return r.color;return this.nearest(t)}nearest(t){let r,o,s;for(const n of p(this,_))o=Math.sqrt(Math.pow(t[0]-n.color[0],2)+Math.pow(t[1]-n.color[1],2)+Math.pow(t[2]-n.color[2],2)),(r===void 0||o<r)&&(r=o,s=n.color);return s}}_=new WeakMap;const q=class q{constructor(t){E(this,L,new Array(1<<3*j));for(let r=0;r<t.length;r+=4){let o=t[r]>>b,s=t[r+1]>>b,n=t[r+2]>>b,i=q.getColorIndex(o,s,n);p(this,L)[i]=(p(this,L)[i]??0)+1}}sample(t,r,o){const s=t>>b,n=r>>b,i=o>>b;return this.sampleWithReducedColor(s,n,i)}sampleWithReducedColor(t,r,o){const s=q.getColorIndex(t,r,o);return p(this,L)[s]??0}static getColorIndex(t,r,o){return(t<<2*j)+(r<<j)+o}};L=new WeakMap;let Y=q;function ut(e,t){let r=1e6,o=0,s=1e6,n=0,i=1e6,u=0;for(let c=0;c<e.length;c+=4){const h=e[c]>>b,a=e[c+1]>>b,f=e[c+2]>>b;h<r?r=h:h>o&&(o=h),a<s?s=a:a>n&&(n=a),f<i?i=f:f>u&&(u=f)}return new D(r,o,s,n,i,u,t)}function ht(e,t,r,o,s){const n=s+"1",i=s+"2";for(let u=e[n];u<=e[i];u++)if(t[u]>o/2){let c=e.copy(),h=e.copy(),a=u-e[n],f=e[i]-u,l,g=0;for(a<=f?l=Math.min(e[i]-1,~~(u+f/2)):l=Math.max(e[n],~~(u-1-a/2));!t[l];)l++;for(g=r[l];!g&&t[l-1];)g=r[--l];return c[i]=l,h[n]=c[i]+1,[c,h]}throw new Error("VBox can't be cut")}function ft(e,t){if(!t.count())return[t.copy(),void 0];const r=t.r2-t.r1+1,o=t.g2-t.g1+1,s=t.b2-t.b1+1,n=Math.max(r,o,s);if(t.count()==1)return[t.copy(),void 0];let i=0;const u=[],c=[];if(n==r)for(let a=t.r1;a<=t.r2;a++){let f=0;for(let l=t.g1;l<=t.g2;l++)for(let g=t.b1;g<=t.b2;g++)f+=e.sampleWithReducedColor(a,l,g);i+=f,u[a]=i}else if(n==o)for(let a=t.g1;a<=t.g2;a++){let f=0;for(let l=t.r1;l<=t.r2;l++)for(let g=t.b1;g<=t.b2;g++)f+=e.sampleWithReducedColor(l,a,g);i+=f,u[a]=i}else if(n==s)for(let a=t.b1;a<=t.b2;a++){let f=0;for(let l=t.r1;l<=t.r2;l++)for(let g=t.g1;g<=t.g2;g++)f+=e.sampleWithReducedColor(l,g,a);i+=f,u[a]=i}else throw new Error("Not Reached");u.forEach(function(a,f){c[f]=i-a});const h=n==r?"r":n==o?"g":"b";return ht(t,u,c,i,h)}function gt(e,t){if(e.length<4||t<2||t>256)throw new Error("Invalid Arguments. There must be at least one pixel, and the max color must be between 2 and 256");const r=new Y(e),o=ut(e,r),s=new X((c,h)=>G(c.count(),h.count()));s.push(o);const n=(c,h)=>{let a=c.size(),f=0,l;for(;f<z;){if(a>=h||f++>z)return;if(l=c.pop(),!l||l.count()===0){l&&c.push(l),f++;continue}const[g,M]=ft(r,l);c.push(g),M&&(c.push(M),a++)}};n(s,ct*t);const i=new X(function(c,h){return G(c.count()*c.volume(),h.count()*h.volume())});for(;s.size();){const c=s.pop();if(!c)throw new Error("VBox is null");i.push(c)}n(i,t);const u=new lt;for(;i.size();){const c=i.pop();if(!c)throw new Error("VBox is null");u.push(c)}return u}function mt(e,t,r=10){const o=dt(e.data,r),s=gt(o,t),n=s?s.palette():null;return console.log(n,t),n}function dt(e,t){const r=Math.floor(e.length/4),o=Math.max(1,Math.round(r/t)),s=new Uint8ClampedArray(o*4);for(let n=0;n<o;n++){const i=Math.round(n*r/o);s[n*4+0]=e[i*4+0],s[n*4+1]=e[i*4+1],s[n*4+2]=e[i*4+2],s[n*4+3]=e[i*4+3]}return s}/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const tt=Symbol("Comlink.proxy"),pt=Symbol("Comlink.endpoint"),wt=Symbol("Comlink.releaseProxy"),v=Symbol("Comlink.finalizer"),U=Symbol("Comlink.thrown"),et=e=>typeof e=="object"&&e!==null||typeof e=="function",bt={canHandle:e=>et(e)&&e[tt],serialize(e){const{port1:t,port2:r}=new MessageChannel;return K(e,t),[r,[r]]},deserialize(e){return e.start(),Mt(e)}},yt={canHandle:e=>et(e)&&U in e,serialize({value:e}){let t;return e instanceof Error?t={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:t={isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},rt=new Map([["proxy",bt],["throw",yt]]);function Et(e,t){for(const r of e)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function K(e,t=globalThis,r=["*"]){t.addEventListener("message",function o(s){if(!s||!s.data)return;if(!Et(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:n,type:i,path:u}=Object.assign({path:[]},s.data),c=(s.data.argumentList||[]).map(P);let h;try{const a=u.slice(0,-1).reduce((l,g)=>l[g],e),f=u.reduce((l,g)=>l[g],e);switch(i){case"GET":h=f;break;case"SET":a[u.slice(-1)[0]]=P(s.data.value),h=!0;break;case"APPLY":h=f.apply(a,c);break;case"CONSTRUCT":{const l=new f(...c);h=Tt(l)}break;case"ENDPOINT":{const{port1:l,port2:g}=new MessageChannel;K(e,g),h=St(l,[l])}break;case"RELEASE":h=void 0;break;default:return}}catch(a){h={value:a,[U]:0}}Promise.resolve(h).catch(a=>({value:a,[U]:0})).then(a=>{const[f,l]=H(a);t.postMessage(Object.assign(Object.assign({},f),{id:n}),l),i==="RELEASE"&&(t.removeEventListener("message",o),nt(t),v in e&&typeof e[v]=="function"&&e[v]())}).catch(a=>{const[f,l]=H({value:new TypeError("Unserializable return value"),[U]:0});t.postMessage(Object.assign(Object.assign({},f),{id:n}),l)})}),t.start&&t.start()}function _t(e){return e.constructor.name==="MessagePort"}function nt(e){_t(e)&&e.close()}function Mt(e,t){return Q(e,[],t)}function V(e){if(e)throw new Error("Proxy has been released and is not useable")}function st(e){return T(e,{type:"RELEASE"}).then(()=>{nt(e)})}const x=new WeakMap,F="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=(x.get(e)||0)-1;x.set(e,t),t===0&&st(e)});function Rt(e,t){const r=(x.get(t)||0)+1;x.set(t,r),F&&F.register(e,t,e)}function At(e){F&&F.unregister(e)}function Q(e,t=[],r=function(){}){let o=!1;const s=new Proxy(r,{get(n,i){if(V(o),i===wt)return()=>{At(s),st(e),o=!0};if(i==="then"){if(t.length===0)return{then:()=>s};const u=T(e,{type:"GET",path:t.map(c=>c.toString())}).then(P);return u.then.bind(u)}return Q(e,[...t,i])},set(n,i,u){V(o);const[c,h]=H(u);return T(e,{type:"SET",path:[...t,i].map(a=>a.toString()),value:c},h).then(P)},apply(n,i,u){V(o);const c=t[t.length-1];if(c===pt)return T(e,{type:"ENDPOINT"}).then(P);if(c==="bind")return Q(e,t.slice(0,-1));const[h,a]=ot(u);return T(e,{type:"APPLY",path:t.map(f=>f.toString()),argumentList:h},a).then(P)},construct(n,i){V(o);const[u,c]=ot(i);return T(e,{type:"CONSTRUCT",path:t.map(h=>h.toString()),argumentList:u},c).then(P)}});return Rt(s,e),s}function Pt(e){return Array.prototype.concat.apply([],e)}function ot(e){const t=e.map(H);return[t.map(r=>r[0]),Pt(t.map(r=>r[1]))]}const it=new WeakMap;function St(e,t){return it.set(e,t),e}function Tt(e){return Object.assign(e,{[tt]:!0})}function H(e){for(const[t,r]of rt)if(r.canHandle(e)){const[o,s]=r.serialize(e);return[{type:"HANDLER",name:t,value:o},s]}return[{type:"RAW",value:e},it.get(e)||[]]}function P(e){switch(e.type){case"HANDLER":return rt.get(e.name).deserialize(e.value);case"RAW":return e.value}}function T(e,t,r){return new Promise(o=>{const s=Ct();e.addEventListener("message",function n(i){!i.data||!i.data.id||i.data.id!==s||(e.removeEventListener("message",n),o(i.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),r)})}function Ct(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}K({generatePalette:d,getPalette:mt})})();
